<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GitHub Hosted Audio Player</title>
    
    <script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>

    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 30px; 
            background-color: #f4f4f9;
        }
        #player-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        #album-art {
            width: 100%;
            max-width: 300px;
            height: auto;
            min-height: 100px; 
            border-radius: 5px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            object-fit: cover; 
        }
        #current-track-name {
            display: block;
            margin: 10px 0;
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }
        audio {
            width: 100%;
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        button { 
            padding: 10px 15px; 
            cursor: pointer; 
            border: none;
            border-radius: 5px;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        #shuffle-btn { background-color: #ff6347; color: white; }
        #loop-btn { background-color: #4682b4; color: white; }
        #next-btn { background-color: #3cb371; color: white; }
        
        button:hover { opacity: 0.8; }
        button:active { opacity: 0.6; }

        /* --- Playlist Styling --- */
        #playlist-button {
            margin-top: 20px;
            background-color: #555;
            color: white;
            padding: 10px 20px;
        }
        #playlist-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
            width: 100%;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-align: left;
            /* >>>>>>>>>>> TEMPORARY DEBUG CHANGE <<<<<<<<< */
            display: block !important; /* FORCED VISIBILITY */
        }
        #playlist-list li {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 0.95em;
        }
        #playlist-list li:hover {
            background-color: #e0f7fa;
        }
        #playlist-list li.current-track {
            background-color: #bbdefb;
            font-weight: bold;
            color: #1a237e;
        }
    </style>
</head>
<body>

    <div id="player-container">
        <h2>My Hosted Music</h2>
        <img id="album-art" src="" alt="Album Art" loading="lazy">
        <span id="current-track-name">Loading...</span>
        <audio id="audio-player" controls preload="auto"></audio>

        <div class="controls">
            <button id="shuffle-btn">Shuffle: OFF</button>
            <button id="loop-btn">Loop: OFF</button>
            <button id="next-btn">Next</button>
        </div>
        
        <button id="playlist-button">Show Playlist</button>
        <ul id="playlist-list"></ul>
    </div>

    <script>
        const jsmediatags = window.jsmediatags; 

        const audio = document.getElementById('audio-player');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const loopBtn = document.getElementById('loop-btn');
        const nextBtn = document.getElementById('next-btn');
        const currentTrackName = document.getElementById('current-track-name');
        const albumArt = document.getElementById('album-art');
        const playlistList = document.getElementById('playlist-list');
        const playlistButton = document.getElementById('playlist-button');

        // --- CONFIGURATION ---
        const BASE_PATH = 'audio/'; 
        const PLACEHOLDER_URL = 'https://play-lh.googleusercontent.com/CQri0N-BiyrACHpHPPtITg3TMV5-bZNbAuhjrg-Zpc_mw6tIWZJFPmT8Yr5r4R-xbA'; 
        
        let rawPlaylist = [
            { track: 'Bloxxin\' What\'s Not Yours.mp3' },
            { track: 'Juice WRLD - Empty Out Your Pockets (Official Fortnite Video) 4.mp3' },
            { track: 'Juice WRLD - Lucid Dreams (Official Music Video) 4.mp3' },
            { track: 'Marmalade Dream (BOKSED Edit).mp3' },
            { track: 'SODA STREET.mp3' },
            { track: 'Stay with me remix.mp3' },
            { track: 'Stay with me remix sped up.mp3' },
            { track: 'boksed - Grew.mp3' },
            { track: 'boxed - skull fairy.mp3' },
            { track: 'caffeine rush.mp3' },
            { track: 'dokodemohitori.wav.mp3' },
            { track: 'look! a turtle.. nevermind..mp3' },
            { track: 'myinternetlife.mp3.mp3' },
            { track: 'nostalgiaisntreal.wav.mp3' }
        ];

        // --- PLAYER STATE ---
        let playlist = [...rawPlaylist]; 
        let originalPlaylist = [...rawPlaylist]; 
        let currentTrackIndex = 0;
        let isShuffling = false;
        let isLooping = false;

        // --- CORE FUNCTIONS ---
        
        function renderPlaylist() {
            playlistList.innerHTML = ''; 
            playlist.forEach((item, index) => {
                const li = document.createElement('li');
                li.textContent = item.track;
                li.dataset.index = index;
                
                if (index === currentTrackIndex) {
                    li.classList.add('current-track');
                }
                
                li.addEventListener('click', () => {
                    loadTrack(index);
                    // Keep the playlist visible if the screen is large
                    if (window.innerWidth <= 600) { 
                         playlistList.style.display = 'none';
                         playlistButton.textContent = 'Show Playlist';
                    }
                });
                
                playlistList.appendChild(li);
            });
        }

        function setAlbumArtFromID3(url) {
            albumArt.src = PLACEHOLDER_URL; // Set placeholder immediately while loading
            
            // NOTE: If this console log doesn't show the correct file URL, the BASE_PATH is wrong.
            console.log("Attempting to read ID3 from:", url); 

            jsmediatags.read(url, {
                onSuccess: function(tag) {
                    const tags = tag.tags;
                    if (tags.picture) {
                        const base64String = tags.picture.data.map(byte => String.fromCharCode(byte)).join('');
                        const mimeType = tags.picture.format;
                        // Create a data URL from the binary image data
                        albumArt.src = `data:${mimeType};base64,${btoa(base64String)}`;
                    } else {
                        albumArt.src = PLACEHOLDER_URL;
                    }
                },
                onError: function(error) {
                    console.error("Error reading ID3 tags (Likely file access issue):", error);
                    albumArt.src = PLACEHOLDER_URL;
                }
            });
        }

        function loadTrack(index) {
            if (playlist.length === 0) return;
            
            currentTrackIndex = index;
            const currentItem = playlist[currentTrackIndex];
            const trackURL = BASE_PATH + currentItem.track;
            
            // 1. Set Audio Source
            audio.src = trackURL; 
            currentTrackName.textContent = currentItem.track;
            
            // 2. Set Album Art 
            setAlbumArtFromID3(trackURL);
            
            // 3. Update UI
            renderPlaylist(); 
            
            audio.load();
            audio.play().catch(e => {
                console.log('Playback requires user interaction or was blocked:', e);
            });
        }

        function playNextTrack() {
            if (playlist.length === 0) return;
            
            const nextIndex = currentTrackIndex + 1;
            
            if (nextIndex < playlist.length) {
                loadTrack(nextIndex);
            } else if (isLooping) {
                loadTrack(0);
            } else {
                audio.pause();
                audio.currentTime = 0;
                currentTrackName.textContent = playlist[currentTrackIndex].track + ' (Playlist Finished)';
                renderPlaylist(); 
            }
        }

        // --- SHUFFLE LOGIC (omitted for brevity, assume correct) ---

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        shuffleBtn.addEventListener('click', () => {
            isShuffling = !isShuffling;
            shuffleBtn.textContent = `Shuffle: ${isShuffling ? 'ON' : 'OFF'}`;
            
            const currentTrack = playlist[currentTrackIndex].track;

            if (isShuffling) {
                shuffleArray(playlist);
            } else {
                playlist = [...originalPlaylist];
            }
            
            currentTrackIndex = playlist.findIndex(item => item.track === currentTrack);

            if (!audio.paused) {
                loadTrack(currentTrackIndex);
            } else {
                currentTrackName.textContent = playlist[currentTrackIndex].track;
                renderPlaylist(); 
            }
        });


        // --- LOOP, NEXT, & EVENTS LOGIC ---

        loopBtn.addEventListener('click', () => {
            isLooping = !isLooping;
            loopBtn.textContent = `Loop: ${isLooping ? 'ON' : 'OFF'}`;
        });

        nextBtn.addEventListener('click', () => {
            playNextTrack();
        });

        audio.addEventListener('ended', () => {
            playNextTrack();
        });

        playlistButton.addEventListener('click', () => {
            const isVisible = playlistList.style.display !== 'none';
            // >>>>>>>>>>> DEBUG CHANGE <<<<<<<<<
            // Revert the temporary display change after debugging if needed
            // playlistList.style.display = isVisible ? 'none' : 'block';
            playlistList.style.display = 'block'; // Keep it simple for now
            playlistButton.textContent = isVisible ? 'Show Playlist' : 'Hide Playlist';
        });

        // --- INITIALIZATION ---
        if (playlist.length > 0) {
            loadTrack(0);
        } else {
            currentTrackName.textContent = 'Playlist is empty.';
        }
    </script>
</body>
</html>
